<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ title }}</title>
  <meta name="description" content="Daily food pairing ideas, served fresh">
  <link rel="icon" href="/favicon.ico">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6998682919715138" crossorigin="anonymous"></script>
  <script src="https://unpkg.com/lunr/lunr.js"></script>
  <style>
    body {
      font-family: 'Inter', sans-serif;
      margin: 0;
      padding: 0 1rem;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
      background-color: #fff;
      color: #222;
    }
    header {
      text-align: center;
      padding: 2rem 0 1rem;
    }
    nav {
      text-align: center;
      margin-bottom: 1.5rem;
    }
    nav a {
      margin: 0 1rem;
      text-decoration: none;
      color: #3366cc;
      font-weight: bold;
    }
    footer {
      margin-top: 3rem;
      text-align: center;
      font-size: 0.85rem;
      color: #666;
    }
    .post-list {
      list-style: none;
      padding: 0;
    }
    .post-list li {
      margin-bottom: 1.2rem;
      padding: 1rem;
      border-radius: 8px;
      background: #f5f5f5;
      box-shadow: 0 1px 5px rgba(0, 0, 0, 0.04);
    }
    .post-list a {
      font-size: 1.1rem;
      font-weight: 600;
      color: #222;
      text-decoration: none;
    }
    .post-list a:hover {
      text-decoration: underline;
    }
    .post-date {
      font-size: 0.9rem;
      color: #777;
    }
    form.search-form {
      text-align: center;
      margin-top: 0;
      margin-bottom: 2rem;
    }
    input[type="search"] {
      padding: 0.5rem;
      font-size: 1rem;
      width: 70%;
      max-width: 400px;
    }
  </style>
</head>
<body>
  <header>
    <h1>üçΩÔ∏è What To Eat With</h1>
    <p>Daily food pairing ideas, served fresh</p>
  </header>

  <nav>
    <a href="/">Home</a>
    <a href="/about/">About</a>
    <a href="/contact/">Contact</a>
    <a href="/privacy-policy/">Privacy</a>
  </nav>

  <div style="margin-top: 0;">
    <form class="search-form" onsubmit="event.preventDefault(); window.location.href='/search/?q=' + encodeURIComponent(this.q.value)">
      <input type="search" name="q" placeholder="Search food pairings..." />
    </form>
  </div>

  <!-- AdSense placeholder -->
  <div style="text-align:center; margin-bottom:2rem;">
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-6998682919715138"
         data-ad-slot="1234567890"
         data-ad-format="auto"
         data-full-width-responsive="true"></ins>
    <script>
         (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
  </div>

  <main>
    {{ content | safe }}
  </main>

  <footer>
    <p>¬© {{ "" | year }} What To Eat With</p>
  </footer>

  <script>
    let lunrIndex, lunrData;

    async function initLunr() {
      const res = await fetch('/search.json');
      lunrData = await res.json();

      lunrIndex = lunr(function () {
        this.ref('url');
        this.field('title');
        this.field('excerpt');

        lunrData.forEach(doc => this.add(doc));
      });
    }

    function performSearch(query) {
      if (!lunrIndex) return;

      const results = lunrIndex.search(query);
      const container = document.getElementById('search-results');
      container.innerHTML = '';

      if (results.length === 0) {
        container.innerHTML = '<p>No results found.</p>';
        return;
      }

      results.forEach(result => {
        const match = lunrData.find(d => d.url === result.ref);
        const el = document.createElement('div');
        el.innerHTML = `<p><a href="${match.url}">${match.title}</a><br><small>${match.excerpt}</small></p>`;
        container.appendChild(el);
      });
    }

    document.addEventListener('DOMContentLoaded', () => {
      initLunr();

      const topSearch = document.querySelector('.search-form input');
      if (topSearch) {
        topSearch.addEventListener('keypress', e => {
          if (e.key === 'Enter') {
            e.preventDefault();
            window.location.href = `/search/?q=${encodeURIComponent(topSearch.value)}`;
          }
        });
      }

      const searchInput = document.querySelector('#search');
      if (searchInput) {
        const params = new URLSearchParams(window.location.search);
        const initialQuery = params.get('q');
        if (initialQuery) {
          searchInput.value = initialQuery;
          performSearch(initialQuery);
        }

        searchInput.addEventListener('input', () => {
          performSearch(searchInput.value);
        });
      }
    });
  </script>
</body>
</html>
